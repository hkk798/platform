<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>æ¸¸å…‰é˜ - çƒ­é—¨æ¦œå•</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <style>
        body { background-color: #121212; color: #e0e0e0; }
        .card { background-color: #1e1e1e; border: 1px solid #333; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); border-color: #0d6efd; }
        .navbar { background-color: #000 !important; border-bottom: 1px solid #333; }
        .section-title { border-left: 5px solid #ffc107; padding-left: 15px; margin-bottom: 20px; color: white; }
        .filter-box { background-color: #1e1e1e; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #333; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark mb-4">
    <div class="container-fluid">
        <a class="navbar-brand text-warning fw-bold" href="/">ğŸ† æ¸¸å…‰é˜æ’è¡Œæ¦œ</a>
        <a href="/search" class="btn btn-outline-info ms-3 me-auto">ğŸ® æ›´å¤šæ¸¸æˆ / ç­›é€‰</a>
        <div class="d-flex align-items-center">
            <div th:if="${session.currentUser == null}">
                <a href="/login" class="btn btn-outline-secondary me-2">ç™»å½•</a>
                <a href="/register" class="btn btn-primary">æ³¨å†Œ</a>
            </div>
            <div th:if="${session.currentUser != null}" class="dropdown">
                <a href="/cart" class="btn btn-outline-warning me-3">ğŸ›’ è´­ç‰©è½¦</a>
                <button class="btn btn-dark border-secondary dropdown-toggle" type="button" id="userMenu" data-bs-toggle="dropdown">
                    ğŸ‘¤ <span th:text="${session.currentUser.username}">User</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
                    <li><a class="dropdown-item" href="/logout">é€€å‡ºç™»å½•</a></li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<div class="container">

    <div th:if="${products != null}" class="filter-box">
        <form action="/search" method="get" class="row g-3">
            <div class="col-md-6">
                <input type="text" name="keyword" class="form-control bg-dark text-white border-secondary" placeholder="ğŸ” æœç´¢æ¸¸æˆå (æ”¯æŒæ¨¡ç³ŠåŒ¹é…)..." th:value="${keyword}">
            </div>

            <div class="col-md-4">
                <div class="bg-dark border-secondary p-2 rounded d-flex flex-wrap gap-3" style="border: 1px solid #6c757d;">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genre" value="Action" id="checkAction"
                               th:checked="${selectedGenres != null and #lists.contains(selectedGenres, 'Action')}">
                        <label class="form-check-label text-white" for="checkAction">åŠ¨ä½œ</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genre" value="RPG" id="checkRPG"
                               th:checked="${selectedGenres != null and #lists.contains(selectedGenres, 'RPG')}">
                        <label class="form-check-label text-white" for="checkRPG">RPG</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genre" value="Strategy" id="checkStrategy"
                               th:checked="${selectedGenres != null and #lists.contains(selectedGenres, 'Strategy')}">
                        <label class="form-check-label text-white" for="checkStrategy">ç­–ç•¥</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genre" value="Adventure" id="checkAdventure"
                               th:checked="${selectedGenres != null and #lists.contains(selectedGenres, 'Adventure')}">
                        <label class="form-check-label text-white" for="checkAdventure">å†’é™©</label>
                    </div>
                </div>
            </div>

            <div class="col-md-2">
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1">ç­›é€‰</button>
                    <a href="/" class="btn btn-outline-secondary" title="è¿”å›é¦–é¡µ">ğŸ  é¦–é¡µ</a>
                </div>
            </div>
        </form>
    </div>

    <div th:if="${products != null}">
        <h3 class="section-title">ğŸ” æœç´¢ç»“æœ</h3>
        <div th:if="${products.isEmpty()}" class="alert alert-secondary text-center">
            æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¸¸æˆã€‚
        </div>

        <div class="row row-cols-1 row-cols-md-5 g-4 mb-5">
            <div class="col" th:each="prod : ${products}" th:if="${prod != null}">
                <div th:replace="~{:: productCard(${prod})}"></div>
            </div>
        </div>
        <hr class="text-secondary">
    </div>

    <div th:if="${topCcuList != null}">
        <h3 class="section-title">ğŸ”¥ çƒ­é—¨æ¸¸ç©æ¦œ (Peak CCU Top 10)</h3>
        <div class="row row-cols-1 row-cols-md-5 g-4 mb-5">
            <div class="col" th:each="prod : ${topCcuList}">
                <div class="card h-100 border-danger">
                    <img th:src="${prod.headerImage}" class="card-img-top" style="height: 120px; object-fit: cover;" onerror="this.style.display='none'">
                    <div class="card-body p-2">
                        <h6 class="card-title text-truncate text-white" th:text="${prod.name}">Name</h6>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-danger">CCU: <span th:text="${prod.peakCcu}">0</span></span>
                        </div>
                        <a th:href="@{'/product/' + ${prod.productId}}" class="btn btn-sm btn-outline-light w-100 stretched-link">æŸ¥çœ‹è¯¦æƒ…</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:if="${topReviewList != null}">
        <h3 class="section-title" style="border-color: #0d6efd;">ğŸ’¬ çƒ­è®®è¯é¢˜æ¦œ (Most Reviewed Top 10)</h3>
        <div class="row row-cols-1 row-cols-md-5 g-4 mb-5">
            <div class="col" th:each="prod : ${topReviewList}">
                <div class="card h-100 border-info">
                    <img th:src="${prod.headerImage}" class="card-img-top" style="height: 120px; object-fit: cover;" onerror="this.style.display='none'">
                    <div class="card-body p-2">
                        <h6 class="card-title text-truncate text-white" th:text="${prod.name}">Name</h6>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-info text-dark">Reviews: <span th:text="${prod.numReviewsTotal}">0</span></span>
                        </div>
                        <a th:href="@{'/product/' + ${prod.productId}}" class="btn btn-sm btn-outline-light w-100 stretched-link">æŸ¥çœ‹è¯¦æƒ…</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div th:fragment="productCard(prod)" class="card h-100">
    <img th:if="${prod != null}" th:src="${prod.headerImage}" class="card-img-top" style="height: 120px; object-fit: cover;" onerror="this.src='https://via.placeholder.com/300x150?text=No+Image'">
    <div class="card-body p-2" th:if="${prod != null}">
        <h6 class="card-title text-truncate text-white" th:text="${prod.name}">Name</h6>
        <p class="text-warning small mb-1">
            <span th:if="${prod.price == 0}">å…è´¹</span>

            <span th:if="${prod.price > 0}">
                ï¿¥<span th:text="${prod.price}">0</span>
            </span>
        </p>

        <a th:href="@{'/product/' + ${prod.productId}}" class="btn btn-sm btn-primary w-100 stretched-link">æŸ¥çœ‹</a>
    </div>
</div>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</body>
</html>